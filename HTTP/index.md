# HTTP 与 浏览器

## HTTP 是什么

HTTP 是一种能够获取如 HTML 这样的网络资源的 protocol（通讯协议）。它是在 Web 上进行数据交换的基础，是一种 client-server 协议，也就是说，请求通常是由像浏览器这样的接受方发起的。一个完整的 Web 文档通常是由不同的子文档拼接而成的，像是文本、布局描述、图片、视频、脚本等等。

## 浏览器如何发起一个 HTTP 请求

> 如果你在浏览器地址栏里键入 Github 的地址：https://www.github.com/， 那么接下来，浏览器会完成哪些动作呢？

1. 构建请求

   首先，浏览器构建请求行信息（如下所示），构建好后，浏览器准备发起网络请求。请求行内包含请求方式、请求 URI 和 HTTP 协议版本。如下：

   ```http
   GET /index.html HTTP1.1
   ```

2. 查找缓存

   在发送请求前浏览器会查找本地缓存，如果找到就会返回资源并结束请求，没找到会重新发送请求。

3. 准备 IP 和端口

   浏览器使用 HTTP 作为应用层协议，使用 TCP/IP 作为传输层协议。所以浏览器是使用 TCP 与服务器建立连接，也就是说 HTTP 的内容是通过 TCP 的传输数据阶段来实现的。IP 地址并不方便记忆，通常使用域名。这个时候要去通过 DNS 解析域名去拿到对应的 IP 地址，这个域名 IP 的映射关系也是可以缓存在浏览器的。

4. 等待 TCP 队列

   浏览器在同一域名下可建立的 TCP 连接数量是有限的，各个浏览器有不同的数量限制。比如：Chrome 最多可以建立 6 个 TCP 连接，多出来的连接需要排队等待。

5. 建立 TCP 连接

   通过三次握手建立连接。

6. 发送 HTTP 请求

   连接建立成功后，浏览器就可以和服务器进行通信了。而 HTTP 中的数据正是在这个通信过程中传输的。

在浏览器发送请求行命令之后，还要以请求头形式发送其他一些信息，把浏览器的一些基础信息告诉服务器。比如包含了浏览器所使用的操作系统、浏览器内核等信息，以及当前请求的域名信息、浏览器端的 Cookie 信息，等等。

## 服务器如何处理 HTTP 请求

> 服务器会根据浏览器的请求信息来准备相应的内容。

1. 返回请求

   服务器首先会返回响应行，包含协议版本跟状态码。并不是所有的请求都可以被服务器处理，服务器会通过请求行的状态码来告诉浏览器它的处理结果。比如：200，404，500。随后，浏览器会想发送请求头式的发送响应头，里面包含了一下服务器的信息。比如：服务器时间，`set-cookie` 和返回的数据类型等。发送完响应头后，服务器就可以继续发送响应体的数据，通常，响应体就包含了 HTML 的实际内容。

2. 断开连接

   通常情况下，一旦服务器向客户端返回了请求数据，它就要关闭 TCP 连接。不过如果浏览器或者服务器在其头信息中加入了：

   ```htttp
   Connection:Keep-Alive
   ```

   那么 TCP 连接在发送后将仍然保持打开状态，这样浏览器就可以继续通过同一个 TCP 连接发送请求。保持 TCP 连接可以省去下次请求时需要建立连接的时间，提升资源加载速度。

## 一个 HTTP 请求的完整流程

![image-20200420232259158](/Users/lf/Desktop/github/Notes/HTTP/images/image-20200420232259158.png)

## HTTP 缓存机制

